!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var s=class{constructor(){this.map=null,this.currentMarker=null,this.infoWindow=null,this.geocoder=null,this.latitude=0,this.longitude=0,this.address="",this.$form=null,this.$addressForm=null,this.$addressInput=null,this.$addressError=null,this.$locationError=null,this.$generalJobFields=null,this.googleMarkerMap={},this.googleMarkerMapHoverListeners={},this.googleMarkerMapClickListeners={},this.disinterestedIconImage=this.cdnImg("koco-man/gray-60x60.png")+"?v=1549075351",this.appliedIconImage=this.cdnImg("koco-man/black-60x60.png"),this.interestedUri="/korea/employment/teacher/job/interested/",this.isProcessing=!1}init(){let e=document.getElementById("map");if(null!==e){let t="greedy";window.jobMap.isRecruiter&&(t="cooperative"),window.jobMap.isMobile?this.jobInterestClickEventType="dblclick":this.jobInterestClickEventType="click",this.map=new google.maps.Map(e,{zoom:window.jobMap.zoom,center:{lat:window.jobMap.lat,lng:window.jobMap.lng},mapTypeControlOptions:{mapTypeIds:["roadmap"]},mapTypeControl:!1,streetViewControl:!1,gestureHandling:t}),this.addExistingJobMarkers(),this.infoWindow=new google.maps.InfoWindow,this.geocoder=new google.maps.Geocoder,this.$addressError=$("#addressSearchError"),this.$locationError=$("#postJobLocationError"),this.$addressInput=$("#mapAddressInput"),this.$warningModal=$("#warningModal"),window.jobMap.isRecruiter&&this.map.addListener("click",e=>{this.placeMarkerAndPanTo(e.latLng)}),this.$form=$("#jobPostForm"),this.$form.submit(e=>(this.$locationError.addClass("no-show"),this.latitude>0&&this.longitude>0?this.submitMapData(this.$form.attr("action")):this.$locationError.removeClass("no-show"),e.preventDefault(),!1)),this.$addressForm=$("#addressSearchForm"),this.$addressForm.submit(e=>(this.$addressError.addClass("no-show"),e.preventDefault(),this.geocodeAddressAndPlaceMarker($("#mapAddressInput").val()),!1)),this.$generalJobFields=$("#generalJobFields"),this.map.addListener("click",()=>{this.closeMapInfoWindow()}),this.$warningModal.length>0&&this.$warningModal.foundation("open")}}cdnImg(e){return"/assets/images/"+e}addExistingJobMarkers(){for(let e=0;e<window.jobMap.markers.length;e++){let t=window.jobMap.markers[e],i=new google.maps.LatLng(t.lat,t.lng),s=this.resolveIconImage(t),r=new google.maps.Marker({position:i,optimized:!1,icon:this.makeComplexIcon(s)});r.setMap(this.map);let n=null;if(0===t.isDisinterested){let e=()=>{this.infoWindow.setContent(t.content),this.infoWindow.open(this.map,r)},i=r.addListener("mouseover",e);n=r.addListener("click",e),this.googleMarkerMapHoverListeners[t.id]=i}else n=r.addListener(this.jobInterestClickEventType,()=>{let e=document.createElement("a");e.setAttribute("href",this.interestedUri+t.id),updateMapMarker(null,e,t.id,0)});this.googleMarkerMap[t.id]=r,this.googleMarkerMapClickListeners[t.id]=n}}resolveIconImage(e){let t=window.jobMap.iconImage;return window.jobMap.isRecruiter?0===e.isJobPoster&&(t=this.disinterestedIconImage):1===e.hasApplied?t=this.appliedIconImage:1===e.isDisinterested&&(t=this.disinterestedIconImage),t}updateExistingJobMarker(e,t,i){let s=this.googleMarkerMap[e],r=1===i?this.disinterestedIconImage:window.jobMap.iconImage;s.setIcon(this.makeComplexIcon(r));let n=this.googleMarkerMapHoverListeners[e],o=this.googleMarkerMapClickListeners[e];google.maps.event.removeListener(n),google.maps.event.removeListener(o),delete this.googleMarkerMapHoverListeners[e],delete this.googleMarkerMapClickListeners[e],1===i?o=s.addListener(this.jobInterestClickEventType,()=>{let t=document.createElement("a");t.setAttribute("href",this.interestedUri+e),updateMapMarker(null,t,e,0)}):(n=s.addListener("mouseover",()=>{this.infoWindow.setContent(t),this.infoWindow.open(this.map,s)}),o=s.addListener("click",()=>{this.infoWindow.setContent(t),this.infoWindow.open(this.map,s)})),this.googleMarkerMapHoverListeners[e]=n,this.googleMarkerMapClickListeners[e]=o,this.infoWindow.close()}placeMarkerAndPanTo(e){null!==this.currentMarker&&this.currentMarker.setMap(null),this.currentMarker=new google.maps.Marker({position:e,map:this.map,icon:this.makeComplexIcon(window.jobMap.markerImage),animation:google.maps.Animation.DROP,draggable:!0}),google.maps.event.addListener(this.currentMarker,"dragend",e=>{this.retrackCurrentLocation(e.latLng)}),this.retrackCurrentLocation(e)}retrackCurrentLocation(e){this.latitude=e.lat(),this.longitude=e.lng(),this.geocodeLatLng(this.latitude,this.longitude,this.currentMarker)}makeComplexIcon(e){return{url:e,size:new google.maps.Size(30,30),scaledSize:new google.maps.Size(30,30)}}geocodeAddressAndPlaceMarker(e){this.geocoder.geocode({address:e},(e,t)=>{if("OK"===t){let t=e[0].geometry.location,i=e[0].formatted_address;this.map.setCenter(t),null!==this.currentMarker&&this.currentMarker.setMap(null),this.currentMarker=new google.maps.Marker({map:this.map,position:t,icon:this.makeComplexIcon(window.jobMap.markerImage),animation:google.maps.Animation.DROP}),this.latitude=t.lat(),this.longitude=t.lng(),this.address=i,this.infoWindow.setContent(i),this.infoWindow.open(this.map,this.currentMarker),$(window).scrollTop(0)}else this.$addressError.removeClass("no-show")})}geocodeLatLng(e,t,i){let s={lat:e,lng:t};this.geocoder.geocode({location:s},(e,t)=>{"OK"===t?e[0]?(this.address=e[0].formatted_address,this.$addressInput.val(e[0].formatted_address),this.infoWindow.setContent(this.address),this.infoWindow.open(this.map,i)):console.log("No results found"):console.log("Geocoder failed due to: "+t)})}submitMapData(e){let t={csrfmiddlewaretoken:$('input[name="csrfmiddlewaretoken"]').val(),title:$("#id_title").val(),class_type:$("#id_class_type").val(),schedule:$("#id_schedule").val(),other_requirements:$("#id_other_requirements").val(),is_full_time:$('input[name="is_full_time"]:checked').val(),salary:$("#id_salary").val(),benefits:$("#id_benefits").val(),pay_rate:$("#id_pay_rate").val(),latitude:this.latitude,longitude:this.longitude,address:this.address};this.isProcessing||(this.isProcessing=!0,$.ajax({type:"POST",url:e,data:t}).done(e=>{let t=$.parseHTML(e),i=$(t).find("#generalJobFields");e.includes("jobPostListConfirm")?window.location=window.jobMap.successLocation:(this.$generalJobFields.html(i.html()),this.isProcessing=!1)}))}closeMapInfoWindow(){this.infoWindow.close()}};class r{constructor(e,t,i){this.tagList=e.split(","),this.$dom=$(t),this.$parent=i,this.detachedCase=null,this.tooltips=[],this.bindRepostHoverEvent(),this.bindTooltipHideEvents()}hasTags(e){let t=!0;for(let i=0;i<e.length;i++){let s=e[i].trim(),r=!1;for(let e=0;e<this.tagList.length;e++)this.tagList[e].trim()===s&&(r=!0);if(!r){t=!1;break}}return t}detach(){this.detachedCase=this.$dom.parent().detach()}attach(){this.$parent.append(this.detachedCase)}bindRepostHoverEvent(){let e=this.$dom.find(".taken-down");e.length>0&&(e.on("mouseover",()=>{e.html("Restore")}),e.on("mouseleave",()=>{e.html("Closed")}))}bindTooltipHideEvents(){if(this.tooltips=$(".flowcard-tooltip"),window.tooltipIsOpen=!1,this.tooltips.length>0){$("body").click(()=>{if(window.tooltipIsOpen){window.tooltipIsOpen=!1;for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];$(t).foundation("hide")}}});for(let e=0;e<this.tooltips.length;e++){let t=this.tooltips[e];$(t).on("show.zf.tooltip",function(){setTimeout(()=>{window.tooltipIsOpen=!0},1e3)})}}}}var n=class{constructor(){this.$filter1=$('input[name="job-filter-1"]'),this.$filter2=$('input[name="job-filter-2"]'),this.$cards=$(".flow-card"),this.$filterCardsParent=$("#filterCardsParent"),this.flowCardList=[],this.activeFilters=[],this.listFilterResults=null}isValid(){return this.$cards.length>0}init(){this.isValid()&&(this.listFilterResults=$("#listFilterResults"),this.setActiveFilters(),this.attachPrimaryFilterListener(),this.attachSecondaryFilterListener(),this.prepareFlowCards(),this.applyFilter())}setActiveFilters(){let e=$('input[name="job-filter-1"]:checked').val();this.$filter2.length>0?this.activeFilters=[e,$('input[name="job-filter-2"]:checked').val()]:this.activeFilters=[e]}attachPrimaryFilterListener(){this.$filter1.click(e=>{let t=$(e.currentTarget).val();this.$filter2.length>0?this.activeFilters=[t,$('input[name="job-filter-2"]:checked').val()]:this.activeFilters=[t],this.applyFilter()})}attachSecondaryFilterListener(){this.$filter2.length>0&&this.$filter2.click(e=>{let t=$(e.currentTarget).val();this.activeFilters=[t,$('input[name="job-filter-1"]:checked').val()],this.applyFilter()})}applyFilter(){for(let e=0;e<this.flowCardList.length;e++){let t=this.flowCardList[e];t.hasTags(this.activeFilters)?t.attach():t.detach()}this.updateDisplayCount()}prepareFlowCards(){for(let e=0;e<this.$cards.length;e++){let t=this.$cards[e];this.flowCardList.push(new r($(t).data("filtertaglist"),t,this.$filterCardsParent))}}updateDisplayCount(){let e=this.flowCardList.length;if(this.$filterCardsParent.children().length===this.flowCardList.length)this.listFilterResults.html(`Currently displaying ${e}/${e}`);else{let t=this.$filterCardsParent.children().length;this.listFilterResults.html(`Currently displaying ${t}/${e}`)}}};class o{constructor(){this.cardElementId="#card-element",this.displayError=document.getElementById("card-errors"),this.form=document.getElementById("payment-form"),this.singleCredit=document.getElementById("id_single_credit"),this.tenCredits=document.getElementById("id_ten_credits"),this.oneHundredCredits=document.getElementById("id_one_hundred_credits"),this.priceDisplay=document.getElementById("priceDisplay"),this.finalPriceDisplay=document.getElementById("finalPriceDisplay"),this.confirmPurchaseButton=document.getElementById("confirmPurchaseButton"),this.$purchaseConfirmModal=$("#purchaseConfirmModal"),this.stripeToken=null,this.singleCreditPrice=20,this.tenCreditsPrice=160,this.oneHundredCreditsPrice=1200}isValid(){return null!=this.form}init(){this.isValid()&&(this.stripe=Stripe(window.stripePublishableKey),this.elements=this.stripe.elements(),this.card=this.elements.create("card",{style:o.getCardStyles()}),this.card.mount(this.cardElementId),this.card.addEventListener("change",e=>this.handleError(e)),this.form.addEventListener("submit",e=>this.handleSubmit(e)),this.singleCredit.addEventListener("change",()=>this.handleQuantityChange()),this.tenCredits.addEventListener("change",()=>this.handleQuantityChange()),this.oneHundredCredits.addEventListener("change",()=>this.handleQuantityChange()),this.handleQuantityChange(),this.confirmPurchaseButton.addEventListener("click",()=>this.stripeTokenHandler()))}handleError(e){e.error?this.displayError.textContent=e.error.message:this.displayError.textContent=""}handleSubmit(e){e.preventDefault(),this.stripe.createToken(this.card).then(e=>{e.error?this.displayError.textContent=e.error.message:(this.stripeToken=e.token,this.showConfirmationPopup())})}handleQuantityChange(){let e=parseInt(this.singleCredit.value),t=parseInt(this.tenCredits.value),i=parseInt(this.oneHundredCredits.value);Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Number.isNaN(i)&&(i=0);let s=e+10*t+100*i+" credits for $"+(e*this.singleCreditPrice+t*this.tenCreditsPrice+i*this.oneHundredCreditsPrice);this.priceDisplay.textContent=s,this.finalPriceDisplay.textContent="Purchase "+s+"?"}showConfirmationPopup(){this.$purchaseConfirmModal.foundation("open")}stripeTokenHandler(){let e=document.createElement("input");e.setAttribute("type","hidden"),e.setAttribute("name","stripeToken"),e.setAttribute("value",this.stripeToken.id),this.form.appendChild(e),this.form.submit()}static getCardStyles(){return{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}}}}var a=o;var l=class{constructor(){this.form=document.getElementById("applicationForm"),this.isProcessing=!1}isValid(){return null!=this.form}init(){this.isValid()&&this.form.addEventListener("submit",e=>this.handleSubmit(e))}handleSubmit(e){e.preventDefault(),this.isProcessing||(this.isProcessing=!0,this.form.submit())}};$(document).foundation(),$(document).ready(function(){let e=new n,t=new a,i=new l;e.init(),t.init(),i.init()}),window.initMap=function(){let e=new s;e.init(),window.jobMapHandle=e},window.updateMapMarker=function(e,t,i,s){return null!==e&&e.preventDefault(),$.ajax({type:"GET",url:$(t).attr("href")}).done(e=>{window.jobMapHandle.updateExistingJobMarker(i,e,s)}),!1}}]);